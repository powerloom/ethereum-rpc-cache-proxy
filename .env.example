# Server Configuration
PORT=3000
HOST=0.0.0.0
LOG_LEVEL=info

# Upstream Ethereum RPC
UPSTREAM_RPC_URL=https://eth-mainnet.g.alchemy.com/v2/your-api-key

# Cache Backend Configuration
# Options:
#   - redis://localhost:6379  (Redis backend - recommended for production)
#   - memory                   (In-memory cache - for development/testing)
#   - (leave empty)           (Auto-detect: tries Redis, falls back to memory)
REDIS_URL=redis://localhost:6379

# Cache Type (optional - overrides auto-detection)
# Options: auto, redis, memory
# CACHE_TYPE=auto

# Cache Configuration
# Block height up to which blocks are cached permanently
# Default: 15537393 (Ethereum merge block)
PERMANENT_CACHE_HEIGHT=15537393

# TTL for latest block number cache (seconds)
LATEST_BLOCK_TTL=2

# TTL for ALL eth_call results (seconds)
# Historical calls (specific block number) are cached permanently
ETH_CALL_TTL=300

# TTL for recent blocks (seconds)
RECENT_BLOCK_TTL=60

# ============================================
# ADVANCED FEATURES (All optional)
# ============================================

# Request Coalescing - Prevents duplicate concurrent requests
# Set to false to disable request coalescing
COALESCING_ENABLED=true
COALESCING_TIMEOUT=30000  # Timeout for in-flight requests (ms)
COALESCING_MAX_RETRIES=3
COALESCING_RETRY_DELAY=1000  # Delay between retries (ms)

# Distributed Locking - Prevents race conditions across multiple instances
# Set to false if running single instance
DISTRIBUTED_LOCK_ENABLED=true
LOCK_TTL=5000  # Lock timeout (ms)
LOCK_RETRY_ATTEMPTS=10
LOCK_RETRY_DELAY=50  # Delay between lock attempts (ms)

# Circuit Breaker - Protects upstream RPC from cascading failures
# Set to false to disable circuit breaker
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_FAILURE_THRESHOLD=5  # Failures before opening circuit
CIRCUIT_SUCCESS_THRESHOLD=2  # Successes before closing circuit
CIRCUIT_TIMEOUT=10000  # Request timeout (ms)
CIRCUIT_RESET_TIMEOUT=60000  # Time before attempting reset (ms)
CIRCUIT_VOLUME_THRESHOLD=10  # Min requests for percentage-based trip
CIRCUIT_ERROR_PERCENTAGE=50  # Error percentage to trip circuit

# Advanced Caching Features
# Stale-While-Revalidate - Serve stale data while fetching fresh
STALE_WHILE_REVALIDATE=false
STALE_TTL=300  # Additional TTL for stale data (seconds)

# Negative Caching - Cache failed requests to prevent repeated failures
NEGATIVE_CACHING=false
NEGATIVE_TTL=60  # TTL for negative cache (seconds)

# Cache Warming - Pre-fetch likely requests
CACHE_WARMING=false
WARMING_INTERVAL=300000  # Interval between warming runs (ms)